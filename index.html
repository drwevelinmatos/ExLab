<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PueriCalc - Ferramentas Pediátricas</title>
  <link href="https://fonts.googleapis.com/css?family=Comfortaa:400,700&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Gotham Book', 'Comfortaa', Arial, sans-serif;
      padding: 20px;
      background: #fff;
      color: #2c3e50;
      font-size: 12px;
    }
    header { text-align: center; margin-bottom: 30px; }
    header img { max-width: 150px; }
    h1 { font-size: 16px; color: rgb(40,90,129); font-family: 'Comfortaa', Arial, sans-serif; text-align: center; margin-bottom: 20px; font-weight: bold; }
    h2 { font-size: 14px; color: rgb(40,90,129); font-family: 'Comfortaa', Arial, sans-serif; text-align: center; margin-bottom: 10px; font-weight: bold; }
    h3 { font-size: 13px; color: rgb(40,90,129); font-family: 'Comfortaa', Arial, sans-serif; text-align: left; }
    label { font-weight: bold; display: block; margin-top: 10px; color: rgb(40,90,129); }
    input, select {
      padding: 8px; margin-top: 5px;
      border-radius: 4px; border: 1px solid #ccc; box-sizing: border-box;
      background: rgb(185,224,229); color: #2c3e50;
      font-family: 'Gotham Book', 'Comfortaa', Arial, sans-serif;
      font-size: 12px;
    }
    input[type=number] { width: 100%; }
    button {
      margin-top: 16px; padding: 10px; width: 100%;
      background: rgb(40,90,129); color: white; font-size: 12px;
      font-family: 'Comfortaa', Arial, sans-serif;
      border: none; border-radius: 6px; cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: rgb(185,224,229); color: rgb(40,90,129);}
    .inline-btns { display: flex; gap: 8px; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 15px;
      font-family: 'Gotham Book', Arial, sans-serif;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #ccc; padding: 6px; vertical-align: middle;
    }
    th { background-color: rgb(40,90,129); color: white; text-align:center; }
    td.nome-exame { text-align: left; font-weight: 600; color: rgb(40,90,129); width: 38%; }
    td.valor-exame { text-align: center; font-weight: bold; width: 32%; transition: background 0.2s; }
    td.faixa-exame { text-align: center; width: 30%; font-size: 12px; }
    .in-range { background-color: #8bc34a !important; color: white !important;}
    .below-range { background-color: #ffc107 !important; color: black !important;}
    .above-range { background-color: #f44336 !important; color: white !important;}
    .neutral { background-color: #2196f3 !important; color: white !important;}
    .resultado, .result { margin-top:15px; padding:10px; border-radius:6px; background:#eef; }
    section { background:#fff; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1); padding:20px; margin:30px auto; max-width:720px;}
    .idade-container { display: flex; gap: 10px; max-width: 330px; margin: 0 auto 10px auto; }
    .idade-container input { flex: 1; }
    #bibliografia { margin: 40px auto; max-width: 720px; line-height:1.4; font-size:12px;}
    #bibliografia ul { padding-left:20px; list-style-type:decimal; }
    #bibliografia ul li { margin-bottom: 5px; }
    footer {
      margin-top:40px; text-align:center; border-top:1px solid #ccc; padding-top:15px; font-size:12px;
    }
  </style>
</head>
<body>

<header>
  <img src="IMG_4625.png" alt="Logo Dr. Wevelin Matos" />
  <h1>PueriCalc - Ferramentas Pediátricas</h1>
</header>

<section>
  <h2>Avaliação Bioquímica Pediátrica</h2>
  <form id="calcForm" onsubmit="return false;">
    <label>Idade do Paciente:</label>
    <div class="idade-container">
      <input type="number" id="anos" placeholder="Anos" min="0" max="18" required />
      <input type="number" id="meses" placeholder="Meses" min="0" max="11" required />
      <input type="number" id="dias" placeholder="Dias" min="0" max="30" required />
    </div>
    <h3>Insira os valores dos exames:</h3>
    <div id="examesTabela"></div>
    <div class="inline-btns">
      <button type="button" onclick="avaliar()">Avaliar</button>
      <button type="button" onclick="limpar()">Limpar</button>
      <button type="button" onclick="imprimirSessao('bioquimica_resultados')">Imprimir</button>
    <div id="bioquimica_resultados">
    <div id="resultado"></div>
    </div>
    </div>
  </form>
</section>

<section>
  <h2>Diagnóstico do Líquor (Pediatria)</h2>
  <label for="aparenciaLiquor">Aparência:</label>
  <select id="aparenciaLiquor">
    <option disabled selected>Selecione</option>
    <option value="claro">Claro</option>
    <option value="turvo">Turvo</option>
    <option value="sanguinolento">Sanguinolento</option>
  </select>
  <label for="hemaciasLiquor">Hemácias (/mm³):</label>
  <input type="number" id="hemaciasLiquor" value="0" min="0" step="1" />
  <label for="celulasLiquor">Células (leucócitos/mm³):</label>
  <input type="number" id="celulasLiquor" min="0" step="1" />
  <label for="proteinaLiquor">Proteína (mg/dL):</label>
  <input type="number" id="proteinaLiquor" min="0" step="any" />
  <label for="glicoseLiquor">Glicose (mg/dL):</label>
  <input type="number" id="glicoseLiquor" min="0" step="any" />
  <label for="predominioLiquor">Predominância celular:</label>
  <select id="predominioLiquor">
    <option disabled selected>Selecione</option>
    <option value="neutrofilos">Neutrófilos</option>
    <option value="linfocitos">Linfócitos</option>
  </select>
  <button onclick="avaliarLiquor()">Avaliar Líquor</button>
  <div id="resultadoLiquor" class="resultado"></div>
</section>

<section>
  <h2>Interpretador de Hemograma Pediátrico</h2>
  <label for="ageRange">Faixa Etária</label>
  <select id="ageRange">
    <option value="">-- Selecione --</option>
    <option value="newborn">Recém-nascido (0-1 mês)</option>
    <option value="infant">1 mês a 1 ano</option>
    <option value="child">2 a 12 anos</option>
    <option value="adolescent">Adolescente (&gt;12 anos)</option>
  </select>
  <label for="hb">Hemoglobina (g/dL)</label>
  <input type="number" step="0.1" id="hb" />
  <label for="ht">Hematócrito (%)</label>
  <input type="number" step="0.1" id="ht" />
  <label for="vcv">VCM (fL)</label>
  <input type="number" step="0.1" id="vcv" />
  <label for="leuco">Leucócitos (mil/mm³)</label>
  <input type="number" step="10" id="leuco" />
  <label for="neutro">Neutrófilos (%)</label>
  <input type="number" step="0.1" id="neutro" />
  <label for="linfo">Linfócitos (%)</label>
  <input type="number" step="0.1" id="linfo" />
  <label for="plaquetas">Plaquetas (mil/mm³)</label>
  <input type="number" step="1000" id="plaquetas" />
  <button onclick="interpretHemograma()">Interpretar Hemograma</button>
  <div id="result" class="result" aria-live="polite"></div>
</section>

<section>
  <h2>Diagnóstico Gasométrico Pediátrico</h2>
  <label for="idade">Idade (anos):</label>
  <input type="number" id="idade" min="0" max="18" />
  <label for="ph">pH:</label>
  <input type="number" step="0.01" id="ph" />
  <label for="paco2">PaCO2 (mmHg):</label>
  <input type="number" step="0.1" id="paco2" />
  <label for="hco3">HCO3- (mEq/L):</label>
  <input type="number" step="0.1" id="hco3" />
  <label for="na">Na+ (mEq/L):</label>
  <input type="number" step="0.1" id="na" />
  <label for="cl">Cl- (mEq/L):</label>
  <input type="number" step="0.1" id="cl" />
  <label for="pao2">PaO2 (mmHg) (opcional):</label>
  <input type="number" step="0.1" id="pao2" />
  <label for="sato2">SatO2 (%) (opcional):</label>
  <input type="number" step="0.1" id="sato2" />
  <label for="lactato">Lactato (mmol/L) (opcional):</label>
  <input type="number" step="0.1" id="lactato" />
  <label for="albumina">Albumina (g/dL) (opcional):</label>
  <input type="number" step="0.1" id="albumina" />
  <button onclick="diagnosticar()">Diagnosticar</button>
  <div class="resultado" id="resultadoGasometria"></div>
</section>

<section id="bibliografia">
  <h2>Bibliografia Utilizada</h2>
  <ul>
    <li>Gold Analisa Diagnóstica Ltda. Valores de Referência Pediátricos. Belo Horizonte - MG.</li>
    <li>Sumita, N. M.; Loureiro, G. Valores de referência dos exames laboratoriais em pediatria. Observatório FMUSP, 2024.</li>
    <li>PNCQ - Programa Nacional de Controle de Qualidade. Valores normais e críticos em exames laboratoriais.</li>
    <li>Sociedade Brasileira de Pediatria (SBP). Exames complementares mais comuns na prática clínica pediátrica. 2023.</li>
    <li>MD.Saúde. Valores de referência dos principais exames laboratoriais. 2025.</li>
    <li>American Academy of Pediatrics (AAP). Guidelines for Pediatric Meningitis Diagnosis and Management.</li>
    <li>Protocolos de neonatologia e pediatria clínica (SBP, Ministério da Saúde).</li>
    <li>Publicações científicas sobre líquor em pediatria (PubMed, SciELO).</li>
    <li>Kovesi T. Acid-Base Disorders in Children. UpToDate, 2025.</li>
    <li>Rose BD, Post TW. Clinical Physiology of Acid-Base and Electrolyte Disorders. 5ª ed. McGraw-Hill, 2001.</li>
    <li>KDIGO Acute Kidney Injury Work Group. Crit Care. 2013;17(1):204.</li>
    <li>Schwartz GJ, Muñoz A, et al. J Am Soc Nephrol. 2009;20(3):629-637.</li>
    <li>Sociedade Brasileira de Pediatria (SBP). Gasometria arterial: conceitos, 2021.</li>
    <li>Stenberg A, Gerdin B. Pediatr Nephrol. 1990;4(2):242-9.</li>
    <li>Nunn JF. Applied Respiratory Physiology. 6ª ed. 2012.</li>
  </ul>
</section>

<footer>
  <p><strong>Dr. Wevelin Matos</strong> | Pediatria e Cardiologia Pediátrica</p>
  <p>CRM/SP 196372 | (16) 99783-2383 | @dr.wevelinmatos</p>
  <p>Ribeirão Preto - SP</p>
</footer>

<script>
// Lista de exames
const examesList = [
  "albumina","alt","ast","bilirrubinaDireta","bilirrubinaTotal","calcio",
  "creatinina","ferritina","fosfataseAlcalina","fosforo","glicose",
  "hemoglobina","hematocrito","leucocitos","neutrofilos","plaquetas",
  "potassio","sodio","triglicerides","colesterolTotal","hdl","ldl","vldl",
  "amilase","lipase","gamaGT","pcr","dhl","vhs","bilirrubinaIndireta",
  "ferro","transferrina","capacidadeLigacaoFerro","ureia","calcioIonico",
  "hemoglobinaGlicada","hcm","vcm","selenio","cloro","zinco","magnesio",
  "tsh","t3","t4","t4livre","vitaminaA","vitaminaB12","vitaminaC",
  "vitaminaD","vitaminaE"
];

const examesNomes = {
  albumina: "Albumina (g/dL)", alt: "ALT (U/L)", ast: "AST (U/L)", bilirrubinaDireta: "Bilirrubina Direta (mg/dL)", bilirrubinaTotal: "Bilirrubina Total (mg/dL)", calcio: "Cálcio (mg/dL)",
  creatinina: "Creatinina (mg/dL)", ferritina: "Ferritina (µg/L)", fosfataseAlcalina: "Fosfatase Alcalina (U/L)", fosforo: "Fósforo (mg/dL)", glicose: "Glicose (mg/dL)", hemoglobina: "Hemoglobina (g/dL)", hematocrito: "Hematócrito (%)",
  leucocitos: "Leucócitos (/µL)", neutrofilos: "Neutrófilos (/µL)", plaquetas: "Plaquetas (/µL)", potassio: "Potássio (mEq/L)", sodio: "Sódio (mEq/L)", triglicerides: "Triglicérides (mg/dL)",
  colesterolTotal: "Colesterol Total (mg/dL)", hdl: "HDL (mg/dL)", ldl: "LDL (mg/dL)", vldl: "VLDL (mg/dL)",
  amilase: "Amilase (U/dL)", lipase: "Lipase (U/L)", gamaGT: "Gama GT (U/L)", pcr: "Proteína C Reativa (mg/dL)", dhl: "DHL (U/L)", vhs: "VHS (mm/h)", bilirrubinaIndireta: "Bilirrubina Indireta (mg/dL)",
  ferro: "Ferro (µg/dL)", transferrina: "Transferrina (mg/dL)", capacidadeLigacaoFerro: "Capacidade de Ligação Total do Ferro (µg/dL)",
  ureia: "Uréia (mg/dL)", calcioIonico: "Cálcio Iônico (mmol/L)", hemoglobinaGlicada: "Hemoglobina Glicada (%)", hcm: "HCM (pg)", vcm: "VCM (fL)",
  selenio: "Selênio (µg/L)", cloro: "Cloro (mEq/L)", zinco: "Zinco (µg/dL)", magnesio: "Magnésio (mg/dL)", tsh: "TSH (µUI/mL)", t3: "T3 (ng/dL)", t4: "T4 (µg/dL)", t4livre: "T4 Livre (ng/dL)",
  vitaminaA: "Vitamina A (µg/dL)", vitaminaB12: "Vitamina B12 (pg/mL)", vitaminaC: "Vitamina C (mg/dL)", vitaminaD: "Vitamina D (ng/mL)", vitaminaE: "Vitamina E (mg/L)"
};

// Faixas completas (idênticas ao seu código anterior)
const faixas = {
  albumina: [
    { idadeMaxDias: 30, min: null, max: null },
    { idadeMaxDias: 182, min: 2.6, max: 4.3 },
    { idadeMaxDias: 365, min: 2.8, max: 4.6 },
    { idadeMaxDias: 1095, min: 2.8, max: 4.8 },
    { idadeMaxDias: 4015, min: 2.9, max: 4.7 }
  ],
  alt: [
    { idadeMaxDias: 30, min: 20, max: 54 },
    { idadeMaxDias: 182, min: 20, max: 54 },
    { idadeMaxDias: 365, min: 26, max: 61 },
    { idadeMaxDias: 1095, min: 26, max: 59 },
    { idadeMaxDias: 4015, min: 19, max: 59 }
  ],
  ast: [
    { idadeMaxDias: 7, min: 26, max: 98 },
    { idadeMaxDias: 30, min: 16, max: 69 },
    { idadeMaxDias: 182, min: 16, max: 61 },
    { idadeMaxDias: 4015, min: 10, max: 41 }
  ],
  bilirrubinaDireta: [
    { idadeMaxDias: 30, min: 0, max: 0.4 },
    { idadeMaxDias: 4015, min: 0, max: 0.4 }
  ],
  bilirrubinaTotal: [
    { idadeMaxDias: 5, min: 0, max: 10.3 },
    { idadeMaxDias: 4015, min: 0, max: 1.2 }
  ],
  calcio: [
    { idadeMaxDias: 0, min: null, max: null },
    { idadeMaxDias: 30, min: 8.2, max: 11.2 },
    { idadeMaxDias: 182, min: 7.6, max: 10.4 },
    { idadeMaxDias: 365, min: 8.8, max: 10.8 },
    { idadeMaxDias: 4015, min: 8.8, max: 10.8 }
  ],
  creatinina: [
    { idadeMaxDias: 30, min: 0.56, max: 1.2 },
    { idadeMaxDias: 365, min: 0.42, max: 0.6 },
    { idadeMaxDias: 4015, min: 0.59, max: 0.80 }
  ],
  ferritina: [
    { idadeMaxDias: 365, min: 7, max: 140 },
    { idadeMaxDias: 4015, min: 7, max: 140 }
  ],
  fosfataseAlcalina: [
    { idadeMaxDias: 1095, min: 75, max: 390 },
    { idadeMaxDias: 4015, min: 75, max: 390 }
  ],
  fosforo: [
    { idadeMaxDias: 10, min: 4.5, max: 9.0 },
    { idadeMaxDias: 730, min: 4.5, max: 6.7 },
    { idadeMaxDias: 4380, min: 3.0, max: 4.5 }
  ],
  glicose: [
    { idadeMaxDias: 60, min: 20, max: 60 },
    { idadeMaxDias: 365, min: 50, max: 80 },
    { idadeMaxDias: 6570, min: 70, max: 99 }
  ],
  hemoglobina: [
    { idadeMaxDias: 30, min: 14, max: 24 },
    { idadeMaxDias: 6570, min: 11, max: 16 }
  ],
  hematocrito: [
    { idadeMaxDias: 30, min: 45, max: 77 },
    { idadeMaxDias: 6570, min: 30, max: 45 }
  ],
  leucocitos: [
    { idadeMaxDias: 1, min: 9000, max: 30000 },
    { idadeMaxDias: 30, min: 5000, max: 21000 },
    { idadeMaxDias: 6570, min: 5000, max: 17000 }
  ],
  neutrofilos: [
    { idadeMaxDias: 1, min: 6000, max: 17000 }
  ],
  plaquetas: [
    { idadeMaxDias: 30, min: 300000, max: 600000 },
    { idadeMaxDias: 6570, min: 150000, max: 400000 }
  ],
  potassio: [
    { idadeMaxDias: 6570, min: 3.5, max: 5.0 }
  ],
  sodio: [
    { idadeMaxDias: 6570, min: 135, max: 148 }
  ],
  triglicerides: [
    { idadeMaxDias: 3650, min: 0, max: 100 },
    { idadeMaxDias: 6570, min: 0, max: 130 }
  ],
  colesterolTotal: [
    { idadeMaxDias: 730, min: 0, max: 170 },
    { idadeMaxDias: 6570, min: 0, max: 170 }
  ],
  hdl: [
    { idadeMaxDias: 6570, min: 35, max: 100 }
  ],
  ldl: [
    { idadeMaxDias: 6570, min: 0, max: 110 }
  ],
  vldl: [
    { idadeMaxDias: 6570, min: 5, max: 40 }
  ],
  amilase: [
    { idadeMaxDias: 6570, min: 60, max: 160 }
  ],
  lipase: [
    { idadeMaxDias: 365, min: 0, max: 29 },
    { idadeMaxDias: 6570, min: 10, max: 46 }
  ],
  gamaGT: [
    { idadeMaxDias: 182, min: 12, max: 122 },
    { idadeMaxDias: 365, min: 3, max: 22 },
    { idadeMaxDias: 6570, min: 2, max: 42 }
  ],
  pcr: [
    { idadeMaxDias: 6570, min: 0, max: 0.5 }
  ],
  dhl: [
    { idadeMaxDias: 365, min: 490, max: 730 },
    { idadeMaxDias: 6570, min: 320, max: 520 }
  ],
  vhs: [
    { idadeMaxDias: 6570, min: 0, max: 20 }
  ],
  bilirrubinaIndireta: [
    { idadeMaxDias: 6570, min: 0, max: 1.0 }
  ],
  ferro: [
    { idadeMaxDias: 182, min: 100, max: 250 },
    { idadeMaxDias: 6570, min: 40, max: 100 }
  ],
  transferrina: [
    { idadeMaxDias: 6570, min: 200, max: 400 }
  ],
  capacidadeLigacaoFerro: [
    { idadeMaxDias: 6570, min: 250, max: 450 }
  ],
  ureia: [
    { idadeMaxDias: 6570, min: 8, max: 36 }
  ],
  calcioIonico: [
    { idadeMaxDias: 6570, min: 1.12, max: 1.32 }
  ],
  hemoglobinaGlicada: [
    { idadeMaxDias: 6570, min: 0, max: 5.7 }
  ],
  hcm: [
    { idadeMaxDias: 6570, min: 27, max: 31 }
  ],
  vcm: [
    { idadeMaxDias: 6570, min: 70, max: 120 }
  ],
  selenio: [
    { idadeMaxDias: 6570, min: 70, max: 150 }
  ],
  cloro: [
    { idadeMaxDias: 6570, min: 97, max: 110 }
  ],
  zinco: [
    { idadeMaxDias: 6570, min: 70, max: 120 }
  ],
  magnesio: [
    { idadeMaxDias: 6570, min: 1.6, max: 2.6 }
  ],
  tsh: [
    { idadeMaxDias: 6570, min: 0.5, max: 5.0 }
  ],
  t3: [
    { idadeMaxDias: 6570, min: 80, max: 200 }
  ],
  t4: [
    { idadeMaxDias: 6570, min: 4.5, max: 12 }
  ],
  t4livre: [
    { idadeMaxDias: 6570, min: 0.7, max: 1.8 }
  ],
  vitaminaA: [
    { idadeMaxDias: 6570, min: 30, max: 80 }
  ],
  vitaminaB12: [
    { idadeMaxDias: 6570, min: 200, max: 900 }
  ],
  vitaminaC: [
    { idadeMaxDias: 6570, min: 0.4, max: 2.0 }
  ],
  vitaminaD: [
    { idadeMaxDias: 6570, min: 20, max: 50 }
  ],
  vitaminaE: [
    { idadeMaxDias: 6570, min: 5, max: 20 }
  ]
}; // <-- fim do objeto faixas

// Monta a tabela de exames dinâmicamente
function criarTabelaExames() {
  let html = `<table><thead>
    <tr><th>Exame</th><th>Valor inserido</th><th>Faixa normal</th></tr>
  </thead><tbody>`;
  examesList.forEach(nome => {
    html += `
    <tr>
      <td class="nome-exame">${examesNomes[nome]}</td>
      <td class="valor-exame"><input type="number" id="${nome}" name="${nome}" style="width: 90px; font-size: 12px;" step="any" autocomplete="off"></td>
      <td class="faixa-exame" id="faixa-${nome}"></td>
    </tr>
    `;
  });
  html += '</tbody></table>';
  document.getElementById('examesTabela').innerHTML = html;
}
if (document.getElementById('examesTabela')) criarTabelaExames();

function idadeEmDias(anos, meses, dias) {
  return (anos || 0) * 365 + (meses || 0) * 30 + (dias || 0);
}
function obterFaixa(nomeExame, idadeDias) {
  if (!faixas[nomeExame]) return null;
  for (let faixa of faixas[nomeExame]) {
    if (idadeDias <= faixa.idadeMaxDias) return faixa;
  }
  return faixas[nomeExame][faixas[nomeExame].length - 1];
}
function avaliarValor(valor, faixa) {
  if (!faixa || faixa.min == null || faixa.max == null) return { classe: 'neutral', mensagem: 'Sem faixa definida' };
  if (valor < faixa.min) return { classe: 'below-range', mensagem: `${faixa.min} - ${faixa.max}` };
  if (valor > faixa.max) return { classe: 'above-range', mensagem: `${faixa.min} - ${faixa.max}` };
  return { classe: 'in-range', mensagem: `${faixa.min} - ${faixa.max}` };
}
function avaliar() {
  const anos = parseInt(document.getElementById('anos').value) || 0;
  const meses = parseInt(document.getElementById('meses').value) || 0;
  const dias = parseInt(document.getElementById('dias').value) || 0;
  const idadeTotal = idadeEmDias(anos, meses, dias);
  examesList.forEach(nome => {
    const input = document.getElementById(nome);
    const tdValor = input.parentElement;
    const tdFaixa = document.getElementById('faixa-' + nome);
    const valor = parseFloat(input.value);
    const faixa = obterFaixa(nome, idadeTotal);
    if (isNaN(valor)) {
      tdValor.className = "valor-exame";
      tdFaixa.textContent = "";
      return;
    }
    const resultado = avaliarValor(valor, faixa);
    tdValor.className = "valor-exame " + resultado.classe;
    tdFaixa.textContent = resultado.mensagem;
  });
}
function limpar() {
  document.getElementById('anos').value = "";
  document.getElementById('meses').value = "";
  document.getElementById('dias').value = "";
  examesList.forEach(nome => {
    const input = document.getElementById(nome);
    input.value = "";
    const tdValor = input.parentElement;
    const tdFaixa = document.getElementById('faixa-' + nome);
    tdValor.className = "valor-exame";
    tdFaixa.textContent = "";
  });
}
function imprimirSessao(id) {
  // Guarda conteúdo completo
  var conteudo = document.getElementById(id).innerHTML;
  var estilo = `
  <style>
    body { font-family: 'Gotham Book','Comfortaa',Arial,sans-serif; font-size:12px; color:#2c3e50;}
    table {width:100%; border-collapse:collapse; font-size:12px;}
    th,td {border:1px solid #ccc; padding:6px;}
    th {background:rgb(40,90,129); color:white;}
    td.in-range { background:#8bc34a; color:white;}
    td.below-range { background:#ffc107; color:black;}
    td.above-range { background:#f44336; color:white;}
    td.neutral { background:#2196f3; color:white;}
    h2,h3 {color:rgb(40,90,129);}
  </style>`;
  var w = window.open('', '', 'height=800,width=700');
  w.document.write('<html><head><title>Resultado para Impressão</title>');
  w.document.write(estilo);
  w.document.write('</head><body >');
  w.document.write(conteudo);
  w.document.write('</body></html>');
  w.document.close();
  w.focus();
  setTimeout(function(){ w.print(); }, 400);
}

/* --- FUNÇÕES DO LÍQUOR --- */
function avaliarLiquor() {
  const aparencia = document.getElementById('aparenciaLiquor').value;
  const hemacias = parseInt(document.getElementById('hemaciasLiquor').value) || 0;
  const celulasBrutas = parseInt(document.getElementById('celulasLiquor').value);
  const proteina = parseFloat(document.getElementById('proteinaLiquor').value);
  const glicose = parseFloat(document.getElementById('glicoseLiquor').value);
  const predom = document.getElementById('predominioLiquor').value;

  if (!aparencia || isNaN(celulasBrutas) || isNaN(proteina) || isNaN(glicose) || !predom) {
    alert("Por favor, preencha todos os campos corretamente.");
    return;
  }

  const celulasCorrigidas = celulasBrutas - (hemacias / 500);
  const celulasLiquida = celulasCorrigidas > 0 ? celulasCorrigidas : 0;

  let diag = "Líquor normal.";
  let cond = "Conduta: Observação e seguimento clínico.";

  if (aparencia === "sanguinolento") {
    diag = "Hemorragia subaracnóidea ou líquor sanguinolento (trauma).";
    cond = "Solicitar neuroimagem urgente e avaliação especializada.";
  } else if (aparencia === "turvo" && predom === "neutrofilos" && glicose < 40 && proteina > 100 && celulasLiquida > 100) {
    diag = "Meningite bacteriana provável.";
    cond = "Iniciar antibioticoterapia empírica intravenosa imediata e manejo hospitalar.";
  } else if (aparencia === "claro" && predom === "linfocitos" && glicose >= 40 && celulasLiquida < 100) {
    diag = "Meningite viral provável.";
    cond = "Suporte clínico, hidratação e observação; antivirais se indicados.";
  } else if (aparencia === "claro" && predom === "linfocitos" && glicose < 40 && proteina > 200) {
    diag = "Meningite tuberculosa provável.";
    cond = "Iniciar esquema específico para tuberculose meníngea conforme protocolo.";
  } else if (aparencia === "claro" && celulasLiquida <= 5 && proteina < 45 && glicose >= 40) {
    diag = "Líquor normal.";
    cond = "Nenhuma conduta específica necessária.";
  } else if (celulasLiquida > 5 && predom === "linfocitos" && glicose >= 40) {
    diag = "Processo inflamatório/viral em estágio inicial.";
    cond = "Acompanhamento com suporte clínico.";
  } else {
    diag = "Alterações inespecíficas no líquor.";
    cond = "Investigação complementar e monitoramento clínico.";
  }

  document.getElementById("resultadoLiquor").innerHTML = `
    <p><strong>Aparência:</strong> ${aparencia}</p>
    <p><strong>Hemácias (/mm³):</strong> ${hemacias}</p>
    <p><strong>Células brutas (/mm³):</strong> ${celulasBrutas}</p>
    <p><strong>Células corrigidas (/mm³):</strong> ${celulasLiquida.toFixed(1)}</p>
    <p><strong>Proteína (mg/dL):</strong> ${proteina}</p>
    <p><strong>Glicose (mg/dL):</strong> ${glicose}</p>
    <p><strong>Predominância celular:</strong> ${predom === "neutrofilos" ? "Neutrófilos" : "Linfócitos"}</p>
    <hr>
    <p><strong>Diagnóstico:</strong> ${diag}</p>
    <p><strong>Conduta:</strong> ${cond}</p>
  `;
}

/* --- FUNÇÕES DO HEMOGRAMA --- */
const referencia = {
  newborn: { hb: [14,22], ht: [45,65], vcm: [92,120], leuco: [9000,30000], neutro: [50,70], linfo: [20,40], plaquetas: [150000,450000] },
  infant: { hb: [11,14], ht: [30,40], vcm: [72,84], leuco: [6000,17500], neutro: [35,50], linfo: [50,70], plaquetas: [150000,450000] },
  child: { hb: [11,14], ht: [35,45], vcm: [75,95], leuco: [5000,15000], neutro: [40,60], linfo: [30,50], plaquetas: [150000,450000] },
  adolescent: { hb: [12,16], ht: [36,48], vcm: [80,100], leuco: [4500,11000], neutro: [50,70], linfo: [20,40], plaquetas: [150000,400000] }
};
function checkRange(value,min,max){return value>=min&&value<=max;}
function interpretHemograma() {
  const age = document.getElementById('ageRange').value;
  if (!age) { displayResult("Por favor, selecione uma faixa etária."); return; }
  let hb = parseFloat(document.getElementById('hb').value);
  let ht = parseFloat(document.getElementById('ht').value);
  let vcm = parseFloat(document.getElementById('vcv').value);
  let leuco = parseInt(document.getElementById('leuco').value);
  let neutro = parseFloat(document.getElementById('neutro').value);
  let linfo = parseFloat(document.getElementById('linfo').value);
  let plaquetas = parseInt(document.getElementById('plaquetas').value);

  if ([hb, ht, vcm, leuco, neutro, linfo, plaquetas].some(v => isNaN(v))) {
    displayResult("Por favor, preencha todos os campos com valores válidos.");
    return;
  }
  const ref = referencia[age];
  let resultados = [];
  if (!checkRange(hb, ref.hb[0], ref.hb[1])) {
    if (hb < ref.hb[0]) {
      resultados.push("Indicativo de anemia: valores baixos de hemoglobina podem ser causados por deficiências nutricionais, perda sanguínea ou doenças crônicas.");
      resultados.push("Conduta: Investigar causa da anemia, avaliar ferro, B12, folato; adaptar dieta; considerar tratamento específico.");
    } else {
      resultados.push("Hemoglobina elevada (policitemia): pode indicar desidratação ou produção excessiva de glóbulos vermelhos.");
      resultados.push("Conduta: Avaliação clínica, considerar causas de hipoxia crônica, possível tratamento médico.");
    }
  }
  if (!checkRange(ht, ref.ht[0], ref.ht[1])) {
    if (ht < ref.ht[0]) resultados.push("Hematócrito baixo reforça anemia.");
    else resultados.push("Hematócrito alto reforça policitemia.");
  }
  if (!checkRange(vcm, ref.vcm[0], ref.vcm[1])) {
    if (vcm < ref.vcm[0]) resultados.push("VCM baixo sugere anemia microcítica (ex: deficiência de ferro).");
    else resultados.push("VCM alto sugere anemia macrocítica (ex: deficiência de vitamina B12 ou folato).");
  }
  if (!checkRange(leuco, ref.leuco[0], ref.leuco[1])) {
    if (leuco < ref.leuco[0]) {
      resultados.push("Leucopenia: risco aumentado de infecções, pode ser devido a infecções virais ou medicações.");
      resultados.push("Conduta: Monitorar quadro clínico, investigar causas.");
    } else resultados.push("Leucocitose: provável infecção ou inflamação. Avaliar diferencial para melhor diagnóstico.");
  }
  if (!checkRange(neutro, ref.neutro[0], ref.neutro[1])) {
    if (neutro < ref.neutro[0]) {
      resultados.push("Neutropenia: maior risco de infecções bacterianas graves.");
      resultados.push("Conduta: Avaliação médica urgente, investigar causas.");
    } else resultados.push("Neutrofilia: comum em infecções bacterianas ou inflamações agudas.");
  }
  if (!checkRange(linfo, ref.linfo[0], ref.linfo[1])) {
    if (linfo < ref.linfo[0]) {
      resultados.push("Linfopenia: pode indicar imunossupressão ou infecções virais.");
      resultados.push("Conduta: Avaliação imunológica e acompanhamento clínico.");
    } else resultados.push("Linfocitose: comum em infecções virais, linfomas ou leucemias.");
  }
  if (!checkRange(plaquetas, ref.plaquetas[0], ref.plaquetas[1])) {
    if (plaquetas < ref.plaquetas[0]) {
      resultados.push("Plaquetopenia: risco aumentado de sangramento, pode ser por infecções, doenças autoimunes ou falência medular.");
      resultados.push("Conduta: Monitorar sinais de sangramento e investigar causas.");
    } else resultados.push("Plaquetose: associada a processos inflamatórios, infecciosos ou anemia ferropriva.");
  }
  if (resultados.length === 0) resultados.push("Todos os valores estão dentro da faixa de normalidade para a faixa etária selecionada.");
  displayResult(resultados.join("\n\n"));
}
function displayResult(text){document.getElementById('result').innerText=text;}

/* --- FUNÇÕES DO GASOMÉTRICO --- */
function faixaEtariaRef(idade) {
  if (idade === 0) return { pH: [7.35,7.45], PaCO2: [32,45], HCO3: [18,24], PaO2: [50,80] };
  else if (idade >= 1 && idade <= 12) return { pH: [7.35,7.45], PaCO2: [34,39], HCO3: [20,24], PaO2: [80,100] };
  else return { pH: [7.35,7.45], PaCO2: [35,45], HCO3: [22,26], PaO2: [80,100] };
}
function causasDisturbios(tipo, gap) {
  const causas = {
    'acidose metabólica': {
      elevado: ["Cetoacidose diabética","Insuficiência renal","Acidose lática (choque, sepse)","Intoxicações: salicilatos, metanol, etilenoglicol"],
      normal: ["Diarreia","Acidose tubular renal","Fístulas pancreaticas ou biliares"]
    },
    'alcalose metabólica': { default: ["Vômitos persistentes","Uso de diuréticos","Síndrome de Bartter/Gitelman"] },
    'acidose respiratória': { default: ["Doenças pulmonares graves (asma, bronquiolite, pneumonia grave)","Depressão do SNC (intoxicações, convulsões, trauma crânio-encefálico)","Hipoventilação por fraqueza muscular (distrofias)"] },
    'alcalose respiratória': { default: ["Hiperpneia (ansiedade, dor, febre)","Sepse","Lesão aguda do SNC"] },
    'distúrbio misto': { default: ["Duas ou mais causas acidobásicas simultâneas (ex: choque com insuficiência renal + hiperventilação)"] }
  };
  if (tipo === 'acidose metabólica') return gap > 12 ? causas[tipo].elevado : causas[tipo].normal;
  else return causas[tipo]?.default || ["Causas não específicas/idiopáticas"];
}
function sugestaoExames(tipo, gap) {
  const exames = {
    'acidose metabólica': {
      elevado: ["Solicitar glicemia, corpos cetônicos","Função renal (ureia/creatinina)","Dosagem de lactato","Exames tóxicos: salicilatos, álcool, metanol"],
      normal: ["Dosar eletrólitos","Avaliar função renal tubular","Exame de fezes"]
    },
    'acidose respiratória': { default: ["Radiografia de tórax","Gasometria venosa/arterial","Monitorização respiratória"] },
    'alcalose metabólica': { default: ["Dosar eletrólitos","Avaliar função renal"] },
    'distúrbio misto': { default: ["Avaliação multidisciplinar","Exames complementares conforme suspeitas clínicas"] }
  };
  if (tipo === 'acidose metabólica') return gap > 12 ? exames[tipo].elevado : exames[tipo].normal;
  else return exames[tipo]?.default || [];
}
function diagnosticar() {
  const idade = parseInt(document.getElementById('idade').value);
  const pH = parseFloat(document.getElementById('ph').value);
  const PaCO2 = parseFloat(document.getElementById('paco2').value);
  const HCO3 = parseFloat(document.getElementById('hco3').value);
  const Na = parseFloat(document.getElementById('na').value);
  const Cl = parseFloat(document.getElementById('cl').value);
  const PaO2input = document.getElementById('pao2').value;
  const PaO2 = PaO2input ? parseFloat(PaO2input) : null;
  const albuminaInput = document.getElementById('albumina').value;
  const albumina = albuminaInput ? parseFloat(albuminaInput) : null;

  if (isNaN(pH) || isNaN(PaCO2) || isNaN(HCO3) || isNaN(Na) || isNaN(Cl) || isNaN(idade)) {
    document.getElementById('resultadoGasometria').innerText =
      "Todos os campos obrigatórios devem ser preenchidos com valores numéricos válidos.";
    return;
  }

  const ref = faixaEtariaRef(idade);
  const gapAnionico = Na - (Cl + HCO3);
  const gapCorrigido = albumina ? gapAnionico + 2.5 * (4.0 - albumina) : gapAnionico;

  let diagnosticos = [], causas = [], exames = [], alertas = [];

  if (pH < ref.pH[0]) {
    if (HCO3 < ref.HCO3[0]) {
      diagnosticos.push(`Acidose metabólica (gap aniônico ${gapCorrigido > 12 ? 'elevado' : 'normal'})`);
      causas = causasDisturbios('acidose metabólica', gapCorrigido);
      exames = sugestaoExames('acidose metabólica', gapCorrigido);
    } else if (PaCO2 > ref.PaCO2[1]) {
      diagnosticos.push('Acidose respiratória');
      causas = causasDisturbios('acidose respiratória');
      exames = sugestaoExames('acidose respiratória');
    } else {
      diagnosticos.push('Distúrbio misto com acidose predominante');
      causas = causasDisturbios('distúrbio misto');
      exames = sugestaoExames('distúrbio misto');
    }
  } else if (pH > ref.pH[1]) {
    if (HCO3 > ref.HCO3[1]) {
      diagnosticos.push('Alcalose metabólica');
      causas = causasDisturbios('alcalose metabólica');
      exames = sugestaoExames('alcalose metabólica');
    } else if (PaCO2 < ref.PaCO2[0]) {
      diagnosticos.push('Alcalose respiratória');
      causas = causasDisturbios('alcalose respiratória');
      exames = sugestaoExames('alcalose respiratória');
    } else {
      diagnosticos.push('Distúrbio misto com alcalose predominante');
      causas = causasDisturbios('distúrbio misto');
      exames = sugestaoExames('distúrbio misto');
    }
  } else {
    diagnosticos.push('pH dentro da faixa normal');
  }

  if (pH < 7.20) alertas.push("pH < 7,20: Risco de instabilidade cardiovascular. Indicação de internação em UTI pediátrica.");
  if (PaO2 !== null && PaO2 < 60) alertas.push("PaO2 < 60 mmHg: Insuficiência respiratória aguda grave.");

  let resultado = `Diagnóstico(s):\n- ${diagnosticos.join('\n- ')}\n\nCausas possíveis:\n- ${causas.join('\n- ')}\n\nExames sugeridos:\n- ${exames.join('\n- ')}\n\nAlertas Clínicos:\n- ${alertas.length ? alertas.join('\n- ') : "Nenhum alerta clínico."}`;
  document.getElementById('resultadoGasometria').innerText = resultado;
}
</script>
</body>
</html>





